---
layout: mypost
title: CentOS创建部署
categories: [运维]
extMath: true

---

# CentOS创建部署

## 背景

在极空间内的虚拟机创建CentOS

![image-20231107155347283](https://bear-iot-c-test.oss-cn-shenzhen.aliyuncs.com/biji/202311071556938.png)

已经更新了源

已经完成了SSH连接

## 安装MySQL

### 添加 yum 源

1.1 下载 MySQL 5.7 的 rpm 包：

```bash
wget https://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpmCOPY
```

1.2 安装 rpm 包：

```bash
sudo rpm -ivh mysql57-community-release-el7-9.noarch.rpmCOPY
```

安装完毕后，会在 `/etc/yum.repos.d/` 目录下生成两个 Repo 文件：

```
mysql-community.repo
mysql-community-source.repo
```

### 安装 MySQL

2.1 执行 yum 安装命令：

```bash
sudo yum install mysql-serverCOPY
```

在安装过程中，会有提示确认信息，一般一路输入 `y` 即可。

**如果出现以下错误，意味着在安装 MySQL 5.7 时，缺少公钥文件。**

> ```
> Public key for mysql-community-common-5.7.42-1.el7.x86_64.rpm is not installed
> 
>  Failing package is: mysql-community-common-5.7.42-1.el7.x86_64
>  GPG Keys are configured as: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
> ```
>
> 请尝试使用以下命令导入 MySQL 的 GPG 密钥，并重新执行安装命令：
>
> ```
> sudo rpm --import http://repo.mysql.com/RPM-GPG-KEY-mysql-2022
> ```
>
> 这将为您导入 MySQL 的 GPG 密钥，作为验证 MySQL 资源的一种方式。

如果看到以下输出，则表明安装成功：

```bash
Complete!COPY
```

### 启动 MySQL

3.1 启动 MySQL：

```bash
systemctl start mysqldCOPY
```

3.2 查看 MySQL 状态：

```bash
systemctl status mysqldCOPY
```

3.3 重启 MySQL：

```bash
systemctl restart mysqldCOPY
```

3.4 停止 MySQL：

```bash
systemctl stop mysqldCOPY
```

3.5 设置开机启动：

```bash
systemctl enable mysqldCOPY
```

### 登录 MySQL

4.1 获取 root 用户在首次登录时生成的临时密码：

```bash
grep 'temporary password' /var/log/mysqld.logCOPY
```

命令的输出会显示 root 用户在首次登录时生成的临时密码。例如：

```
[Note] A temporary password is generated for root@localhost: eKgLclnYq1;K
```

其中 `eKgLclnYq1;K` 就是临时密码。

4.2 登录 MySQL：

```bash
mysql -u root -pCOPY
```

通过上述命令登录 MySQL 后，需要修改 root 用户的临时密码，否则会在执行部分命令时提示错误，例如执行 `show databases` 命令，会出现以下错误信息：

```
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
```

4.3 修改 root 用户密码：

```bash
ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';COPY
```

其中，`新密码` 是您设置的新密码。请注意，MySQL 密码策略要求密码长度大于 8 个字符，包含大小写字母、数字及其它字符（如标点符号）。

4.4 查询 MySQL 密码策略：

```bash
SHOW VARIABLES LIKE 'validate_password%';COPY
```

命令的输出将会显示 MySQL 密码策略规则，包括密码长度、大小写字母、数字及其它字符的要求等。例如：

```bash
+--------------------------------------+--------+
| Variable_name                        | Value    |
+--------------------------------------+----------+
| validate_password_check_user_name    | OFF      |
| validate_password_dictionary_file    |          |
| validate_password_length             | 8        |
| validate_password_mixed_case_count   | 1        |
| validate_password_number_count       | 1        |
| validate_password_policy             | MEDIUM   |
| validate_password_special_char_count | 1        |
+--------------------------------------+---------+COPY
```

这意味着，密码长度必须大于 8 个字符，且密码中必须包含大小写字母、数字及至少一个特殊字符，如 `!`、`@`、`#`、`$` 等。请根据实际情况设置新密码。

完整的 MySQL 5.7 安装和登录教程到此结束。